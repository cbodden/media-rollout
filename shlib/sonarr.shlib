function _sonarr()
{
    apt install nzbdrone
    chown -R sonarr:sonarr /opt/NzbDrone/

    cat <<EOF >/lib/systemd/system/sonarr.service
    [Unit]
    Description=Sonarr Daemon
    After=network.target

    [Service]
    User=sonarr
    Group=sonarr

    Type=simple
    ExecStart=/usr/bin/mono /opt/NzbDrone/NzbDrone.exe -nobrowser
    TimeoutStopSec=20
    KillMode=process
    Restart=on-failure

    [Install]
    WantedBy=multi-user.target
EOF

    chown -R sonarr:downloads /${_PATH}/tv
    systemctl daemon-reload
    systemctl enable sonarr.service
}

function _sonarr_configure()
{
    systemctl start sonarr.service
    sleep 5
    systemctl start nzbhydra2.service
    sleep 5
    systemctl stop sonarr.service
    systemctl stop nzbhydra2.service

    local _SAB_API=$(cat ${_SAB_HOME}/sabnzbd.ini \
        | awk '/^api_key/ {print $3}')

    local _NH_API=$(yq read ${_NH_HOME}/nzbhydra.yml main.apiKey)

    rm -rf ${_SR_HOME}/*

    cat ${PROGDIR}/config_files/sonarr_BASE-EDIT.sql \
        | sed "/\bSABnzbd\b/s|\bRM_SH\b|${_IP}|g" \
        | sed "/\bSABnzbd\b/s/\bRM_SP\b/8080/g" \
        | sed "/\bSABnzbd\b/s/\bRM_SA\b/${_SAB_API}/g" \
        | sed "/\bNZBHydra2\b/s|\bRM_NH\b|${_IP}|g" \
        | sed "/\bNZBHydra2\b/s/\bRM_NP\b/5076/g" \
        | sed "/\bNZBHydra2\b/s/\bRM_NA\b/${_NH_API}/g" \
        >> ${_SR_HOME}/nzbdrone.sql

    echo .exit | sqlite3 -init ${_SR_HOME}/nzbdrone.sql ${_SR_HOME}/nzbdrone.db
    chown -R sonarr:sonarr ${_SR_HOME}
    systemctl start sonarr
}
