_SERVICE_NAME+=( "sickrage:8081" )
_SERVICE_ID+=( "TV_sickrage:8081" )

function _sickrage_install()
{
    local _FNC_NAME=$(echo ${FUNCNAME} \
        | cut -d_ -f2)

    getent group downloads || groupadd downloads

    if [ -z "$(getent passwd ${_FNC_NAME})" ]
    then
        addgroup ${_FNC_NAME}
        adduser --system ${_FNC_NAME} --ingroup ${_FNC_NAME}
        usermod -a -G downloads ${_FNC_NAME}
    fi

    cd /opt/
    git clone https://github.com/SickRage/SickRage.git /opt/sickrage
    chown -R sickrage:sickrage /opt/sickrage/

    cat <<EOF /lib/systemd/system/sickrage.service
    [Unit]
    Description=SickRage Daemon
    After=network-online.target

    [Service]
    User=sickrage
    Group=sickrage

    Type=forking
    GuessMainPID=no
    ExecStart=/usr/bin/python3 /opt/sickrage/SiCKRAGE.py -q --daemon --nolaunch --datadir=/opt/sickrage
    Restart=on-failure
    TimeoutStopSec=300

    [Install]
    WantedBy=multi-user.target
EOF

    systemctl daemon-reload
    systemctl enable ${_FNC_NAME}
}

function _sickrage_remove()
{
    local _FNC_NAME=$(echo ${FUNCNAME} \
        | cut -d_ -f2)

    if [[ -z $(systemctl status ${_FNC_NAME} | grep Active) ]]
    then
        printf "%s\n" \
            "[${BLU}***${CLR}] ${_FNC_NAME} NOT INSTALLED OR DAMAGED"

    else
        printf "%s\n" \
            "[${RED}***${CLR}] ${_FNC_NAME} IS ABOUT TO BE REMOVED"

        systemctl stop ${_FNC_NAME}
        systemctl kill ${_FNC_NAME}
        systemctl disable ${_FNC_NAME}
        sleep 5
        rm -r /opt/sickrage
        rm -rf /home/${_FNC_NAME}
        rm /etc/systemd/system/sickrage.service
        systemctl daemon-reload

        userdel ${_FNC_NAME}

        printf "%s\n" \
            "[${BLU}***${CLR}] ${_FNC_NAME} HAS BEEN REMOVED"

    fi
}
